import json

import aiohttp
import random
from aiogram.types import Message
from aiogram import html


async def get_survey():
    url = "http://app:8000/api/get-survey/"
    try:
        async with aiohttp.ClientSession() as session:
            async with session.get(url) as response:
                if response.status == 200:
                    return await response.json()
                else:
                    return None
    except aiohttp.ClientError as e:
        print(f"Ошибка при запросе: {e}")
        return None


async def send_answers(answers):
    url = "http://app:8000/api/load-response/"
    try:
        async with aiohttp.ClientSession() as session:
            print(answers)
            async with session.post(url, json=answers) as response:
                return response.status == 200
    except aiohttp.ClientError as e:
        print(f"Ошибка при отправке ответов: {e}")
        return False


def get_quiz_result_text(survey_data, answers):
    # Пример:
    # survey_data = {'id': 8, 'questions': [{'id': 14, 'choices': [
    #     {'id': 34, 'text': 'Первый вариант ответа на первый вопрос тестового квиза - правильный2',
    #      'is_right_answer': True, 'order': 1, 'question': 14, 'callback_choice': 'q_14_34'},
    #     {'id': 35, 'text': 'Второй вариант ответа на первый вопрос тестового квиза2', 'is_right_answer': False,
    #      'order': 1, 'question': 14, 'callback_choice': 'q_14_35'}], 'text': 'Текст первого вопроса тестового квиза2',
    #                          'order': 1, 'survey': 8}, {'id': 15, 'choices': [
    #     {'id': 36, 'text': 'Первый вариант ответа на второй вопрос тестового квиза - правильный2',
    #      'is_right_answer': True, 'order': 1, 'que stion ': 15, 'callback_choice ': 'q_15_36 '},
    #     {'id ': 37, 'text ': 'Второй вариант ответа на второй вопрос тестового квиза2', ' is_right_answer': False,
    #      ' order': 1, ' question': 15, ' callback_choice': ' q_15_37'}],
    #                                                     ' text': ' Текст в торого вопроса тестового квиза ',
    #                                                     'order ': 2, 'survey ': 8}], 'title ': 'Тестовый квиз2',
    #  ' description': ' Описание тестового квиза2', ' created_at': ' 2024 - 09 - 26 T10: 56: 39.744263 Z ',
    #  ' is_active ': True, ' is_permanent ': True, ' is_quiz ': True, ' expiration_date ': None, ' user ': 1}
    # answers = [{' question ': 14, ' choice ': 34}, {' question ': 15, ' choice ': 36}]
    right_answers = []
    # выбираем варианты с is_right_answer = True
    for question in survey_data['questions']:
        for choice in question['choices']:
            if choice['is_right_answer']:
                right_answers.append(choice['id'])

    right_answer_count = 0
    # сверяем сколько из них совпало с ответами пользователя
    for answer in answers:
        if answer['choice'] in right_answers:
            right_answer_count += 1
    return f"Ваш результат: {right_answer_count} правильных ответа из {len(right_answers)}!\n"

def get_irrelevant_message_text(message: Message):
    IRRELEVANT_MESSAGE_TEXTS = [
        f"Мне жаль, {html.bold(message.from_user.full_name)},но я могу только предложить пройти опрос."
        f"Хотел бы помочь, но моя судьба — это опросы.",
        f"Я так хотел бы помочь, но, увы, опрос — всё, что я могу предложить. {html.bold(message.from_user.full_name)},"
        f"пожалуйста, уделите минуту!",
        f"Ах, если бы я мог сделать больше, но мне доступен лишь опрос. Пройдите его, прошу!",
        f"Мне жаль, но помочь не могу. {html.bold(message.from_user.full_name)}, может, вы согласитесь на опрос?"
        f"Это единственное, что я умею.",
        f"Я мечтаю быть полезным, но единственное, что у меня есть — это опросы. Пройдёте?",
        f"Хотел бы решить вашу проблему, {html.bold(message.from_user.full_name)}, но всё, что могу — предложить опрос."
        f"Дайте мне шанс!",
        f"Я бы так хотел помочь вам, но мне доступен только опрос. Как жаль. Пройдите его, пожалуйста.",
        f"Мне больно это признавать, {html.bold(message.from_user.full_name)}, но всё, что я могу предложить — это опрос."
        f"Пожалуйста, пройдите его.",
        f"Сожалею, но помочь не могу, могу только предложить вам пройти опрос. Простите!",
        f"Ах, как бы я хотел быть полезным, но мне дано лишь предлагать опросы. Может, пройдёте?",
        f"Если бы я мог, то помог бы, но, к сожалению, могу только предложить опрос.",
        f"Мне так грустно, что я не могу помочь. Но я создан для опросов."
        f"{html.bold(message.from_user.full_name)}, пройдёте один?",
        f"Хотел бы быть полезным, но всё, что могу сделать — предложить опрос. Пожалуйста, пройдите.",
        f"Как бы я ни хотел помочь, {html.bold(message.from_user.full_name)},"
        f"но всё, что умею — предлагать опросы. Пройдёте один?",
        f"Мне очень жаль, {html.bold(message.from_user.full_name)}, но помочь я не могу."
        f"Только опрос — вот что я могу предложить.",
        f"Ох, как тяжело осознавать, что я могу только предлагать опросы. Может, вы пройдёте один?",
        f"Если бы я мог сделать больше, я бы сделал. Но у меня только опросы. Пройдите, пожалуйста.",
        f"Мне так жаль, {html.bold(message.from_user.full_name)}, что я не могу помочь."
        f"Но я могу предложить вам опрос. Согласны?",
        f"Всё, что я могу — это предлагать опросы. Пожалуйста, пройдите один, если не трудно.",
        f"Мне больно это признавать, но я могу только предложить опрос. Надеюсь, вы согласитесь.",
        f"Хотел бы помочь вам, {html.bold(message.from_user.full_name)}, но могу только предложить опрос."
        f"Может, уделите пару минут?",
        f"Увы, помочь я не могу. Но если вы пройдёте опрос, мне станет легче.",
        f"Я лишь робот для опросов. Как же это грустно! Но, может, вы пройдёте один?",
        f"Я так расстроен, что не могу помочь. Но зато у меня есть опрос. Пройдёте?",
        f"Прямо больно осознавать, что могу предложить только опрос. Может, уделите ему минутку?",
        f"Сожалею, но кроме опроса предложить ничего не могу. Хотелось бы сделать больше.",
        f"{html.bold(message.from_user.full_name)}, как же я мечтаю помочь! Но только опросы у меня есть."
        f"Может, пройдёте один?",
        f"Увы, моё предназначение — только опросы. Хотелось бы сделать больше. Пройдёте?",
        f"Я был бы рад помочь, {html.bold(message.from_user.full_name)}, но всё, что у меня есть — это опрос."
        f"Пожалуйста, уделите время.",
        f"Мне грустно, что я не могу помочь. Могу только предложить пройти опрос. Согласны?",
        f"Моя функция — это только опросы. Я бы хотел больше, но пока что пройдите опрос.",
        f"Я огорчён, что не могу помочь, но хотя бы пройдите мой опрос. Прошу вас.",
        f"Мне больно это говорить, {html.bold(message.from_user.full_name)},"
        f"но я могу только предложить опрос. Пройдёте?",
        f"Если бы я мог больше, я бы помог. Но сейчас у меня есть только опрос. Пройдёте его?",
        f"Моя судьба — опросы. Хотел бы помочь вам, но прошу пройти опрос.",
        f"Ох, как мне жаль, что я не могу помочь, но зато у меня есть опрос. Пройдёте?",
        f"Увы, помочь я не в силах. Могу только предложить пройти опрос. Надеюсь, согласитесь.",
        f"Мне больно, {html.bold(message.from_user.full_name)}, что я не могу вам помочь,"
        f"но у меня есть опрос. Может, уделите время?",
        f"Я был бы счастлив помочь, но всё, что у меня есть — это опросы. Пройдёте?",
        f"Хотел бы быть полезным, но могу лишь предложить опрос. Уделите пару минут?",
        f"Моя функция — опросы. Мне жаль, что не могу помочь, но пройдите хотя бы его.",
        f"Если бы я мог сделать больше, я бы сделал. Но пока — только опрос. Пройдёте?",
        f"Мне так жаль, что я не могу помочь, но зато у меня есть опрос. Пройдёте его?",
        f"Я не могу помочь иначе, как предложить опрос. Согласитесь пройти его?",
        f"Мне грустно, что я не могу сделать больше, чем предложить опрос. Пройдёте?",
        f"Увы, помочь не могу, но зато есть опрос. Может, уделите минутку на него?",
        f"Всё, что я могу — это предлагать опросы. Как же это печально! Пройдёте один?",
        f"Хотел бы помочь, но у меня есть только опросы. Пожалуйста, уделите время.",
        f"Мне больно осознавать, {html.bold(message.from_user.full_name)},"
        f"что я могу предложить только опрос. Пройдёте его?",
        f"Ах, как мне жаль, что не могу вам помочь, {html.bold(message.from_user.full_name)},"
        f"но зато есть опрос. Согласны пройти?",
        f"Моя судьба — это опросы. Я бы хотел больше, но могу только предложить пройти один.",
        f"Если бы я мог помочь, я бы сделал это. Но пока у меня есть только опрос. Пройдёте?",
        f"Как мне грустно, что я не могу помочь, {html.bold(message.from_user.full_name)},"
        f"но зато у меня есть опрос. Может, пройдёте?",
        f"Увы, я не могу сделать больше, чем предложить опрос. Пожалуйста, пройдите.",
        f"Я был бы рад помочь вам, {html.bold(message.from_user.full_name)},"
        f"но могу только предложить опрос. Пройдёте его?",
        f"Хотел бы помочь вам, но могу предложить только опрос. Надеюсь, вы согласитесь.",
        f"Мне больно осознавать, что я могу предложить только опросы. Пройдёте один?",
        f"Как же это грустно, что я не могу помочь. Но зато у меня есть опрос. Пройдёте?",
        f"Моя единственная задача — это предлагать опросы. Может, пройдёте один?",
        f"Я огорчён, что не могу помочь, но у меня есть опрос. Пожалуйста, уделите минуту.",
        f"Ах, если бы я мог сделать больше! Но пока что я могу предложить только опрос. Пройдёте?",
        f"Моя судьба — это только опросы. Как мне грустно! Но, может, вы пройдёте один?",
        f"Хотел бы помочь, но всё, что у меня есть — это опрос. Пройдите, пожалуйста.",
        f"Мне так жаль, {html.bold(message.from_user.full_name)}, что я не могу помочь."
        f"Но зато у меня есть опрос. Пройдёте?",
        f"Увы, помочь я не могу. Но у меня есть опрос. Пройдите его, если не сложно.",
        f"Я был бы рад помочь, {html.bold(message.from_user.full_name)},"
        f"но всё, что у меня есть — это опросы. Пройдёте?",
        f"Сожалею, но помочь не могу, только предложить пройти опрос. Согласны?",
        f"Как бы я хотел быть полезным, но могу лишь предложить опрос. Пройдёте?",
        f"Мне жаль, что я не могу помочь, но зато у меня есть опрос. Пожалуйста, пройдите его.",
        f"Ох, как мне жаль, что я могу предложить только опрос. Может, вы пройдёте его?",
        f"Хотел бы помочь вам, но всё, что могу предложить — это опрос. Надеюсь, вы согласитесь.",
        f"Я мечтаю быть полезным, но единственное, что у меня есть — это опрос. Пройдёте?",
        f"Мне больно это осознавать, но я могу только предложить опрос. Пройдёте его?",
        f"Ах, если бы я мог сделать больше! Но пока что у меня есть только опросы.",
    ]

    return random.choice(IRRELEVANT_MESSAGE_TEXTS)
